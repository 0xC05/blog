<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.7d001f84b9586708d30b.css">.icon-module--root--3xZab{display:inline-flex;align-items:center;justify-content:center}.icon-module--icon--S1jzc{fill:currentColor}.icon-module--label--1keCy{position:relative;display:inline-block;margin-left:4px;line-height:1}.menu-module--mobileMenuContainer--1yLGu{display:none}@media (max-width:683px){.menu-module--mobileMenuContainer--1yLGu{display:flex}}.menu-module--desktopMenuContainer--1G5iC{display:block}@media (max-width:683px){.menu-module--desktopMenuContainer--1G5iC{display:none}}.menu-module--menu--3UWEr{display:flex;flex:0 0 auto;align-items:center;justify-content:flex-start;max-width:100%;padding:0 15px;list-style:none;border-right:1px solid;margin:0 18px 0 auto}.menu-module--menu--3UWEr li{margin:0 12px}.menu-module--menuTrigger--2QS8V{margin-right:10px;padding:0;line-height:0;background:none;color:inherit;border:none;box-shadow:none;outline:none;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer}.menu-module--menu--3UWEr a{display:inline-block;margin-right:15px;text-decoration:none}.menu-module--menu--3UWEr a:last-of-type{margin-right:0}.menu-module--mobileMenu--B1Auu{position:absolute;top:0;right:0;flex-direction:column;align-items:flex-start;background:#fafafa;margin:0;padding:0;text-align:left;list-style:none;border-radius:5px;overflow:hidden;z-index:99}.dark-theme .menu-module--mobileMenu--B1Auu{background:#252627}.menu-module--mobileMenu--B1Auu li{margin:0;white-space:nowrap}.menu-module--mobileMenu--B1Auu li a{display:block;padding:10px 15px}.menu-module--mobileMenuOverlay--24hzr{position:fixed;top:0;bottom:0;left:0;right:0;background:rgba(0,0,0,.2);z-index:10}.menu-module--themeToggle--279Pt{line-height:0;padding:0 5px}.menu-module--subMenuTrigger--1GqTP,.menu-module--themeToggle--279Pt{background:none;color:inherit;border:none;box-shadow:none;-webkit-appearance:none;-moz-appearance:none;appearance:none;outline:none}.menu-module--subMenuTrigger--1GqTP{font-size:inherit;font-weight:inherit;margin:0 12px;padding:0;cursor:pointer}.menu-module--subMenu--3cCmL{position:absolute;max-width:300px;background:#fafafa;box-shadow:0 8px 20px rgba(0,0,0,.12);margin:0;padding:5px;list-style:none;border-radius:5px;top:35px;right:70px;overflow:hidden;z-index:99}.dark-theme .menu-module--subMenu--3cCmL{background:#3b3d42}.menu-module--subMenu--3cCmL li{text-align:left;margin:0;white-space:nowrap}.menu-module--subMenu--3cCmL li a{padding:10px}.menu-module--subMenu--3cCmL li:hover{background:rgba(0,0,0,.05);border-radius:3px;cursor:pointer}.dark-theme .menu-module--subMenu--3cCmL li:hover{background:rgba(0,0,0,.15)}.menu-module--subMenuOverlay--3ef44{position:fixed;top:0;bottom:0;left:0;right:0;z-index:-1}.menu-module--menuArrow--2DLOO{display:inline-block;font-family:Inter UI;margin-left:5px;transform:rotate(90deg)}.header-module--header--32ogj{background:#fafafa;display:flex;align-items:center;justify-content:space-between;position:relative;padding:20px}.dark-theme .header-module--header--32ogj{background:#252627}.header-module--header--32ogj a{text-decoration:none}.header-module--inner--1JVyF{justify-content:space-between;margin:0 auto;width:760px;max-width:100%}.header-module--inner--1JVyF,.header-module--logo--3cCyS{display:flex;align-items:center}.header-module--logo--3cCyS{text-decoration:none;font-weight:700}.header-module--logo--3cCyS img{height:44px}.header-module--mark--3cWG4{margin-right:5px}.header-module--cursor--P4DDY{display:inline-block;width:10px;height:1rem;background:#fe5186;margin-left:5px;border-radius:1px;-webkit-animation:header-module--cursor--P4DDY 1s infinite;animation:header-module--cursor--P4DDY 1s infinite}.header-module--mark--3cWG4,.header-module--text--2pH5m{font-size:18px}.header-module--right--1dEoG{display:flex;position:relative}@-webkit-keyframes header-module--cursor--P4DDY{0%{opacity:0}50%{opacity:1}to{opacity:0}}@keyframes header-module--cursor--P4DDY{0%{opacity:0}50%{opacity:1}to{opacity:0}}@font-face{font-family:Inter UI;font-style:normal;font-weight:400;src:url(/static/Inter-UI-Regular-ecf7c639683dfcb4868861e0c613c455.woff) format("woff")}@font-face{font-family:Inter UI;font-style:italic;font-weight:400;src:url(/static/Inter-UI-Italic-bcf654c7bea165e9dae257206c5521ad.woff) format("woff")}@font-face{font-family:Inter UI;font-style:normal;font-weight:600;src:url(/static/Inter-UI-Medium-48dfecfe37de0ef8f0e2c2d2e6992e9c.woff) format("woff")}@font-face{font-family:Inter UI;font-style:italic;font-weight:600;src:url(/static/Inter-UI-MediumItalic-a9eddc92c84c5f78fba1cb7d7833d31c.woff) format("woff")}@font-face{font-family:Inter UI;font-style:normal;font-weight:800;src:url(/static/Inter-UI-Bold-e2158f600a4b0175b73dfefb0d2fe8f8.woff) format("woff")}@font-face{font-family:Inter UI;font-style:italic;font-weight:800;src:url(/static/Inter-UI-BoldItalic-dbe4ec1d26d41331c91550939a7fd27f.woff) format("woff")}pre[class*=language-],pre[class*=language-]>code{color:#a9a9b3;background:none;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto;background:#1a1a1d!important;border-radius:8px}.token.block-comment,.token.cdata,.token.comment,.token.doctype,.token.prolog{color:hsla(0,0%,100%,.35)}.token.punctuation{color:#a9a9b3}.token.attr-name,.token.deleted,.token.namespace,.token.tag{color:#e2777a}.token.function-name{color:#6196cc}.token.boolean,.token.function,.token.number{color:#f08d49}.token.class-name,.token.constant,.token.property,.token.symbol{color:#f8c555}.token.atrule,.token.builtin,.token.important,.token.keyword,.token.selector{color:#cc99cd}.token.attr-value,.token.char,.token.regex,.token.string,.token.variable{color:#7ec699}.token.entity,.token.operator,.token.url{color:#67cdcc}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.token.inserted{color:green}pre[class*=language-].line-numbers{position:relative;padding-left:65px;counter-reset:linenumber}pre[class*=language-].line-numbers>code{position:relative;white-space:inherit}.line-numbers .line-numbers-rows{position:absolute;pointer-events:none;top:1em;font-size:100%;left:5px!important;width:3em!important;letter-spacing:-1px;border-right:1px solid;opacity:.5;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.line-numbers-rows>span{pointer-events:none;display:block;counter-increment:linenumber}.line-numbers-rows>span:before{content:counter(linenumber);color:#999;display:block;padding-right:.8em;text-align:right}div.code-toolbar{position:relative}div.code-toolbar>.toolbar{position:absolute;top:.3em;right:.2em;transition:opacity .3s ease-in-out;opacity:0}div.code-toolbar:hover>.toolbar{opacity:1}div.code-toolbar>.toolbar .toolbar-item{display:inline-block}div.code-toolbar>.toolbar a{cursor:pointer}div.code-toolbar>.toolbar button{background:none;border:0;color:inherit;font:inherit;line-height:normal;overflow:visible;padding:0;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none}div.code-toolbar>.toolbar a,div.code-toolbar>.toolbar button,div.code-toolbar>.toolbar span{color:#bbb;font-size:.8em;padding:0 .5em;background:#f5f2f0;background:hsla(0,0%,87.8%,.2);box-shadow:0 2px 0 0 rgba(0,0,0,.2);border-radius:.5em}div.code-toolbar>.toolbar a:focus,div.code-toolbar>.toolbar a:hover,div.code-toolbar>.toolbar button:focus,div.code-toolbar>.toolbar button:hover,div.code-toolbar>.toolbar span:focus,div.code-toolbar>.toolbar span:hover{color:inherit;text-decoration:none}.command-line-prompt{border-right:1px solid #999;display:block;float:left;font-size:100%;letter-spacing:-1px;margin-right:1em;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.command-line-prompt>span:before{color:#999;content:" ";display:block;padding-right:.8em}.command-line-prompt>span[data-user]:before{content:"[" attr(data-user) "@" attr(data-host) "] $"}.command-line-prompt>span[data-user=root]:before{content:"[" attr(data-user) "@" attr(data-host) "] #"}.command-line-prompt>span[data-prompt]:before{content:attr(data-prompt)}html{box-sizing:border-box}*,:after,:before{box-sizing:inherit}body{margin:0;padding:0;font-family:Inter UI,-apple-system,BlinkMacSystemFont,Roboto,Segoe UI,Helvetica,Arial,sans-serif;font-size:1rem;font-weight:600;line-height:1.54;background-color:#fff;color:#222;text-rendering:optimizeLegibility;-webkit-font-smoothing:antialiased;font-feature-settings:"liga","tnum","case","calt","zero","ss01","locl";-webkit-overflow-scrolling:touch;-webkit-text-size-adjust:100%}@media (max-width:683px){body{font-size:1rem}}body.dark-theme{background-color:#292a2d;color:#a9a9b3}h1,h2,h3,h4,h5,h6{display:flex;align-items:center;line-height:1.3}h1{font-size:2.625rem}h2{font-size:1.625rem}h3{font-size:1.375rem}h4{font-size:1.125rem}@media (max-width:683px){h1{font-size:2rem}h2{font-size:1.4rem}h3{font-size:1.15rem}h4{font-size:1.125rem}}a{color:inherit}img{display:block;max-width:100%}img.center,img.left{margin-right:auto}img.center,img.right{margin-left:auto}figure{display:table;max-width:100%;margin:25px 0}figure.center,figure.left{margin-right:auto}figure.center,figure.right{margin-left:auto}figure figcaption{font-size:14px;margin-top:5px;opacity:.8}figure figcaption.left{text-align:left}figure figcaption.center{text-align:center}figure figcaption.right{text-align:right}code{font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-feature-settings:normal;font-weight:400;background:#eaeaea;padding:1px 6px;margin:0 2px;border-radius:5px;font-size:.9rem}.dark-theme code{background:#3b3d42}pre{background:#1a1a1d;padding:20px;border-radius:8px;font-size:.9rem;overflow:auto}@media (max-width:683px){pre{white-space:pre-wrap;word-wrap:break-word}}pre code{background:none!important;color:#ccc;margin:0;padding:0;font-size:.9rem}blockquote{border-left:2px solid;margin:40px;padding:10px 20px}@media (max-width:683px){blockquote{margin:10px;padding:10px}}blockquote p:first-of-type{margin-top:0}blockquote p:last-of-type{margin-bottom:0}table{table-layout:fixed;border-collapse:collapse;width:100%;margin:40px 0;border-radius:5px}table,td,th{border:1px solid #222;padding:10px}.dark-theme table,.dark-theme td,.dark-theme th{border-color:#a9a9b3}th{background:#eaeaea}.dark-theme th{background:#3b3d42}ol,ul{margin-left:40px;padding:0}@media (max-width:683px){ol,ul{margin-left:20px}}ol ol{list-style-type:lower-alpha}button,input,textarea{font-family:Inter UI,-apple-system,BlinkMacSystemFont,Roboto,Segoe UI,Helvetica,Arial,sans-serif}.container{flex-direction:column;text-align:center}.container,.content{display:flex;justify-content:center}.content{flex-direction:column;flex:1 0 auto;align-items:center;margin:50px auto;width:100%;max-width:800px}@media (max-width:683px){.content{margin-top:0}}@media (max-width:899px){.content{max-width:660px}}hr{width:100%;border:none;background:#dcdcdc;height:1px}.dark-theme hr{background:#4a4b50}.infoBanner{text-align:left;margin:20px 0 40px;padding:10px 20px;border-radius:10px;width:calc(100% - 40px);background:#eaeaea}.dark-theme .infoBanner{background:#3b3d42}.infoBanner span{font-weight:700}.hidden{display:none}.embedVideo-container{position:relative;padding-bottom:56.25%;height:0;overflow:hidden}.embedVideo-container iframe{position:absolute;top:0;left:0;width:100%;height:100%;border:0}footer{font-size:1rem;text-align:center;margin-bottom:50px}@media (max-width:683px){footer{display:flex;flex-direction:column}}footer .footerCopyrights:not(:first-of-type){margin-left:20px;padding-left:20px;border-left:1px solid}@media (max-width:683px){footer .footerCopyrights:not(:first-of-type){margin:0;padding:0;border:none}}.navigation-module--navigation--1K5eM{display:flex;width:1024px;max-width:100%;margin:80px 0 40px}.navigation-module--button--268P_,.navigation-module--navigation--1K5eM{align-items:center;justify-content:center}.navigation-module--button--268P_{position:relative;display:inline-flex;background:#eaeaea;font-size:1rem;font-weight:700;border-radius:8px;max-width:40%;cursor:pointer;-webkit-appearance:none;-moz-appearance:none;appearance:none}.dark-theme .navigation-module--button--268P_{background:#3b3d42}.navigation-module--button--268P_+.navigation-module--button--268P_{margin-left:10px}.navigation-module--button--268P_ a{display:flex;padding:8px 16px;text-decoration:none}.navigation-module--button--268P_ a,.navigation-module--buttonText--F2wQ_{text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.navigation-module--iconNext--AVU6i{margin-left:8px}.navigation-module--iconPrev--2YR2v{margin-right:8px}.post-module--post--2iiGQ{width:100%;max-width:800px;text-align:left;padding:20px;margin:0 auto 20px}.post-module--post--2iiGQ:not(:last-of-type){border-bottom:1px solid #dcdcdc}.dark-theme .post-module--post--2iiGQ:not(:last-of-type){border-color:#4a4b50}@media (max-width:899px){.post-module--post--2iiGQ{max-width:660px}}.post-module--post--2iiGQ h1{margin:0 0 10px}.post-module--post--2iiGQ img{border-radius:8px}.post-module--title--3CF5R a{text-decoration:none}.post-module--coverImage--2AdMw{border-radius:8px;margin-bottom:40px;box-shadow:0 15px 30px rgba(0,0,0,.1)}.post-module--meta--duw4c{font-size:1rem;margin-bottom:30px}.post-module--tags--2jRm2{margin-top:10px;opacity:.5}.post-module--tag--3Tz-t{margin-right:10px}.post-module--readMore--1HLfk,.post-module--tag--3Tz-t{display:inline-block}.post-module--readMore--1HLfk{text-decoration:none;font-weight:700;margin:20px 0;font-size:1rem}.post-module--postContent--1132g{position:relative}</style><meta name="generator" content="Gatsby 2.23.14"/><title data-react-helmet="true">Digging a Hole Through Obfuscated VBA Malware :: SYN&#x27;s Blog</title><meta data-react-helmet="true" name="description" content="Hello there! How are you doing this fine day? Welcome to my blog post about a fascinating tool which can make your computer’s life hell if…"/><meta data-react-helmet="true" property="og:title" content="Digging a Hole Through Obfuscated VBA Malware"/><meta data-react-helmet="true" property="og:description" content="Hello there! How are you doing this fine day? Welcome to my blog post about a fascinating tool which can make your computer’s life hell if…"/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:title" content="Digging a Hole Through Obfuscated VBA Malware"/><meta data-react-helmet="true" name="twitter:description" content="Hello there! How are you doing this fine day? Welcome to my blog post about a fascinating tool which can make your computer’s life hell if…"/><meta data-react-helmet="true" name="twitter:creator" content="@0xC05"/><meta data-react-helmet="true" name="keywords" content="gatsby, minimal, starter, blog, theme, dark, light, personal site"/><link rel="icon" href="/favicon-32x32.png?v=58f6227653ed9208d1132c12da411f4d"/><link rel="manifest" href="/manifest.webmanifest"/><meta name="theme-color" content="#292a2d"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=58f6227653ed9208d1132c12da411f4d"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=58f6227653ed9208d1132c12da411f4d"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=58f6227653ed9208d1132c12da411f4d"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=58f6227653ed9208d1132c12da411f4d"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=58f6227653ed9208d1132c12da411f4d"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=58f6227653ed9208d1132c12da411f4d"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=58f6227653ed9208d1132c12da411f4d"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=58f6227653ed9208d1132c12da411f4d"/><link as="script" rel="preload" href="/webpack-runtime-a18451bbfb423b887dc4.js"/><link as="script" rel="preload" href="/framework-5fc6169171e885c3b522.js"/><link as="script" rel="preload" href="/app-1653d2c2e6ee77774bf6.js"/><link as="script" rel="preload" href="/styles-89fd2ae28bdf06750a71.js"/><link as="script" rel="preload" href="/commons-1782296e78d0d411ff5d.js"/><link as="script" rel="preload" href="/55027a988c749907c8d0f13018f728b830987428-3bdefe6b5e62d2156c05.js"/><link as="script" rel="preload" href="/component---src-templates-page-js-c8a7600fb6a4a5152f04.js"/><link as="fetch" rel="preload" href="/page-data\vba-macro-obfuscator-analysis\page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data\app-data.json" crossorigin="anonymous"/></head><body class="dark-theme"><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="container"><header class="header-module--header--32ogj"><div class="header-module--inner--1JVyF"><a href="/"><div class="header-module--logo--3cCyS"><span class="header-module--mark--3cWG4">&gt;</span><span class="header-module--text--2pH5m">syn@blog</span><span class="header-module--cursor--P4DDY"></span></div></a><span class="header-module--right--1dEoG"><div class="menu-module--mobileMenuContainer--1yLGu"><button class="menu-module--menuTrigger--2QS8V" style="color:inherit" type="button" aria-label="Menu"><span class="icon-module--root--3xZab" style="cursor:pointer" role="figure"><svg version="1.1" width="24" height="24" viewBox="0 0 48 48" xmlns="http://www.w3.org/2000/svg"><path d="M4 34H40V30H4V34ZM4 24H40V20H4V24ZM4 10V14H40V10H4Z" class="icon-module--icon--S1jzc"></path></svg></span></button></div><div class="menu-module--desktopMenuContainer--1G5iC"><ul class="menu-module--menu--3UWEr"><li><a href="/about">About</a></li></ul></div><button class="menu-module--themeToggle--279Pt" type="button" aria-label="Theme toggle"><span class="icon-module--root--3xZab" style="cursor:pointer" role="figure"><svg version="1.1" width="24" height="24" viewBox="0 0 48 48" xmlns="http://www.w3.org/2000/svg"><path d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z" class="icon-module--icon--S1jzc"></path></svg></span></button></span></div></header><div class="content"><div class="post-module--post--2iiGQ"><div class="post-module--postContent--1132g"><h1 class="post-module--title--3CF5R">Digging a Hole Through Obfuscated VBA Malware</h1><div class="post-module--meta--duw4c">07 July 2020<!-- --> <!-- -->— Written by <!-- -->SYN</div><div class="post-module--coverImage--2AdMw gatsby-image-wrapper" style="position:relative;overflow:hidden"><div aria-hidden="true" style="width:100%;padding-bottom:80.5%"></div><img aria-hidden="true" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAEAklEQVQ4y32U60+TZxTA+68s8YPJZmZcsi9LppvLnNtQg4ojmomK9w0FQancBpMBKlUKik7BG1QFCkKkXMelwKQtnUIpymDdZim3lpZC7YWW/vb0RcO3neTk5Hnec3455z3nObLx8TH0ej06XT8GwwAjI2Zx1jE0ZBI6RH9/v/S9X6djeHgYo3GA3r7f0XZ3S36Dwq+rq4vA0hIRkUUAWm2PFGgwGESAkfa2VrpFgLanB52AdXZ2SkE9Wi3WCRtenw+nw47b7SYQWMLhcBAKhVaAbzwe7HY7s7OzOJ1O5ubmmJ6aZHLSxsz0tHS22Sawz85gtVrxehb4P5FNTExIju9E9XyajKej3DdOktn6D8lqExfbRklUv+S8+jmJD/pJKa7gZ8V1svIVXMjMQC5PZ1tiIcqHjcjGxsawWCxvcWGKtK/5vETHiZoRElqsfHHbzD7VC/ZWmom+/ozYir+IK6mmKn4t2aflbM6rJyFmI+99upfD+WXIPKLkiAbf/oP0plesKehj+80OEh40sbOwgd0lHcRXmfnsci9Hb7UTe6me0szvKTx5hNiiVtJOx/Ht9lhOlaiReb1eCbi0FJSA+X2v+URkcaHpCaNPttF44AN0N7LIHfYS/WiSiko5moPruKR8SFS5idwfd3D2yFHW7M0mvUCBLBgMik4FCC0vSyWrBmc412EjsWWYaf1+BvPWYzm7hUrTFBlDcLWhFmvOWhqzUjlUN8Uv2adQHtjKhsMK0q7cRBYKBYlA37W91DjDiVYLMTVmimuuUlWZRr78J+T3NWTeVpGWlcvDvD2Uxe/kcLmeb/Ib2JNzj/fjFZy5VotscXFRmiOfzysBn/WWc/zQVnpTv6ZY1UzeWJgd7UGudmkYLd3A4JGPGVftxnxsLbfuaYipGCdG2cm6Y8WklqpXSvb7fYSEjRS9YLpMbcpHWJI/xKBMp8rmp8i8iLx1lD/U36FP2ogmZx+Pz0cjT8khLjmHHw7tY/OWKOQ36pCtjmRYAtr0CjSlUbSnf8lvKfEkNv+LvPM1m268JL3kIsrEXRQlnWHnvVdEK2rpLk0WTcvgTmYSBb9WIwuHw0SU8DKRPl9Tq8goTGZ/8lmyjp/kYFEz0TUW1ivHSLhdzt3UTRTs+oq4K41szm3iyl0VD+485kL2Nc4pylYylICRDIVpG7FiGtKiqa/G0vII/YCJtr8XqH7h4KnxTwzPGumoU9PQ+ZyyFiP3W3RUdA1x82kfHQMjq0CJKaABjxuX08Wi5w1Oj5f5eReu2SncjmkWnA7RQBduMbcL804WXQ7euF3i3r76llczXAHOiQURWRaRzs+JjWIX1jXvxie2is/vJyDUL9QnaQC/mGHpXjyMZVHif1vuAasb4FVdAAAAAElFTkSuQmCC" alt="" style="position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover;object-position:center;opacity:1;transition-delay:500ms"/><noscript><picture><source srcset="/static/7cc673619e2f9a990af3069922b2efd2/69585/vba-macro-obfuscator-analysis-article.png 200w,
/static/7cc673619e2f9a990af3069922b2efd2/497c6/vba-macro-obfuscator-analysis-article.png 400w,
/static/7cc673619e2f9a990af3069922b2efd2/ee604/vba-macro-obfuscator-analysis-article.png 800w,
/static/7cc673619e2f9a990af3069922b2efd2/efc77/vba-macro-obfuscator-analysis-article.png 865w" sizes="(max-width: 800px) 100vw, 800px" /><img loading="lazy" sizes="(max-width: 800px) 100vw, 800px" srcset="/static/7cc673619e2f9a990af3069922b2efd2/69585/vba-macro-obfuscator-analysis-article.png 200w,
/static/7cc673619e2f9a990af3069922b2efd2/497c6/vba-macro-obfuscator-analysis-article.png 400w,
/static/7cc673619e2f9a990af3069922b2efd2/ee604/vba-macro-obfuscator-analysis-article.png 800w,
/static/7cc673619e2f9a990af3069922b2efd2/efc77/vba-macro-obfuscator-analysis-article.png 865w" src="/static/7cc673619e2f9a990af3069922b2efd2/ee604/vba-macro-obfuscator-analysis-article.png" alt="" style="position:absolute;top:0;left:0;opacity:1;width:100%;height:100%;object-fit:cover;object-position:center"/></picture></noscript></div><div><hr>
<p>Hello there! How are you doing this fine day? Welcome to my blog post about a fascinating tool which can make your computer’s life hell if you’re not careful enough :P</p>
<p>Macro Malware are very common in the threat world, and it has been in use since Macros were introduced in various applications. The most common type of Macro Malwares is seen in Visual Basic as, Microsoft Introduced Visual Basic for Applications (commonly known as VBA) in their Office product line so users can automate a lot of their day to day work while dealing with office productivity.</p>
<p>Due to some function calls present in VBA, which can easily be used to download a payload from the internet and infect someone’s computer, this has resulted into VBA Macros to be weaponized due to this and little did we know, this thing will be the most used malware in Phishing Campaigns done by APTs all around the world.</p>
<hr>
<p>Introducing <a href="https://github.com/bonnetn/vba-obfuscator">vba-obfuscator</a>, a tool which obfuscates VBA macros in a simple, yet very effective way. This tool was made by <a href="https://github.com/bonnetn/">bonnetn</a> (Github) as a 2018 School Project.
Very neat python tool which takes a VBA script and obfuscates it with multiple methods involved. Here is a sample payload delivery macro malware obfuscated with this obfuscator.</p>
<p>Except for the <code class="language-text">Auto_Open</code> subs, you can’t figure out what is going on because the function names and variable names have been obfuscated with what seems to be Base64. But if you try decoding a Base64 variable name, it returns random characters which again doesn’t make any sense.</p>
<hr>
<h4>Now let’s look at the VirusTotal Detection of this file:-</h4>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/5638675dd95710f1a5e1ac6df6a77798/26530/vba-macro-obfuscator-analysis-vt.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 53%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABEUlEQVQoz41TDW+DIBDl///HZdlMP2alIohRwLvxuHXt1NppLiZ4PN7HoWJMjIeItgv/jGP6PDF9HJnODVOIm70hBFbTNHFK6TkgyvZMX1pKmwwYZH3+2zeOIytrLc/z/BoQzA4106VlajumKQj7hz6QU8Mw/EOyFbmQ/X5galqxoR/WgF1mGGPcB+ycAFZnKcjGIV3/24enAGqt2Xv/nCVebKyvAoQvwIqH85ohwHb9u3l4uuRQso/HWhhD1YJECcUYw865Evkmy5uH8A9y36rMMqcd0/bYIOWXoYBR9QOItK9G5C72YfwU2EE26O6Pjb7PYmtlrfdrQIxNyqftzqLPm5vMLttTgMAYl2FxIQD4DX20X6sJDteFAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="vba macro obfuscator analysis vt"
        title="vba macro obfuscator analysis vt"
        src="/static/5638675dd95710f1a5e1ac6df6a77798/78d47/vba-macro-obfuscator-analysis-vt.png"
        srcset="/static/5638675dd95710f1a5e1ac6df6a77798/56d15/vba-macro-obfuscator-analysis-vt.png 200w,
/static/5638675dd95710f1a5e1ac6df6a77798/d9f49/vba-macro-obfuscator-analysis-vt.png 400w,
/static/5638675dd95710f1a5e1ac6df6a77798/78d47/vba-macro-obfuscator-analysis-vt.png 800w,
/static/5638675dd95710f1a5e1ac6df6a77798/26530/vba-macro-obfuscator-analysis-vt.png 944w"
        sizes="(max-width: 800px) 100vw, 800px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
      />
  </a>
    </span></p>
<p>This sample file’s detection has increased from 8 to 19 over all. But if we take a harmless obfuscated file which prints Hello World, it gives us 5 detections.
While 19 detections (at the time of writing) is still good, but let’s see what Inquest Labs has to say about our sample file:-</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/7eb2530d6c60eee251e9da7792f46c28/4ceeb/vba-macro-obfuscator-analysis-inquest.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 29.000000000000004%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAIAAABM9SnKAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAo0lEQVQY022QgQ7DIAhE/f9vrYgourW22wFpsmV7wXpa1IPEzES073trQ0QREBHSsOzHsc4fLiep6pyztcZcaxWRZlHtWw0ZYw6MiTAejotnQn4VJHG9wQWx9Bu5946nXv9IyOiOz6q3hiPt6tp+oC5kw+rX4ZxzoUIWRJkKuyBiLgH0tm0Q2IAf1ADb4cVqDvzdYPQPUPB1WZOib2utaBgOvwEi5lnnIL0HTwAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="vba macro obfuscator analysis inquest"
        title="vba macro obfuscator analysis inquest"
        src="/static/7eb2530d6c60eee251e9da7792f46c28/78d47/vba-macro-obfuscator-analysis-inquest.png"
        srcset="/static/7eb2530d6c60eee251e9da7792f46c28/56d15/vba-macro-obfuscator-analysis-inquest.png 200w,
/static/7eb2530d6c60eee251e9da7792f46c28/d9f49/vba-macro-obfuscator-analysis-inquest.png 400w,
/static/7eb2530d6c60eee251e9da7792f46c28/78d47/vba-macro-obfuscator-analysis-inquest.png 800w,
/static/7eb2530d6c60eee251e9da7792f46c28/4ceeb/vba-macro-obfuscator-analysis-inquest.png 1073w"
        sizes="(max-width: 800px) 100vw, 800px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
      />
  </a>
    </span></p>
<p>If we read the comment, we see that most of the malicious traits and suspicions are based on the obfuscation. Not what the file does to the system. So now, what do we do? Well we figure out what the obfuscated code does!</p>
<hr>
<h3>DISCLAIMER: I am doing everything here for research purposes, this program is meant for research purposes and neither me or bonnetn are responsible for your actions. For the research, I take a sample Hello World VBA Macro and obfuscated it using the tool.</h3>
<hr>
<p><strong>Sample Code:-</strong></p>
<div class="gatsby-highlight" data-language="vb"><pre class="language-vb"><code class="language-vb"><span class="token keyword">Sub</span> HelloWorld<span class="token punctuation">(</span><span class="token punctuation">)</span>
MsgBox <span class="token string">"Hello World"</span>
<span class="token keyword">End</span> <span class="token keyword">Sub</span></code></pre></div>
<p><strong>Obfuscated Code:-</strong></p>
<div class="gatsby-highlight" data-language="vb"><pre class="language-vb"><code class="language-vb">DQdqmDHFAZsXlO       <span class="token keyword">As</span> <span class="token keyword">Boolean</span>
<span class="token keyword">Private</span> phLmzjBheZF<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token keyword">Xor</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">To</span> <span class="token punctuation">(</span><span class="token number">5</span> <span class="token keyword">Xor</span> <span class="token number">58</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token keyword">As</span> <span class="token keyword">Byte</span>
<span class="token keyword">Private</span> QKJZqUIcJuC<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token keyword">Xor</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">To</span> <span class="token punctuation">(</span><span class="token number">51</span> <span class="token keyword">Xor</span> <span class="token number">76</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">As</span> <span class="token keyword">Byte</span>
<span class="token keyword">Sub</span> nzOxchBVlT<span class="token punctuation">(</span><span class="token punctuation">)</span>
MsgBox hhWpOZVspDmEP<span class="token punctuation">(</span>Array<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token operator">+</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token keyword">Xor</span> <span class="token number">36</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">190</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token number">8</span> <span class="token keyword">Xor</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">41</span> <span class="token keyword">Xor</span> <span class="token number">89</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">131</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token keyword">Xor</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> hhWpOZVspDmEP<span class="token punctuation">(</span>Array<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">134</span><span class="token operator">+</span><span class="token number">57</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">133</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">30</span> <span class="token keyword">Xor</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">162</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token number">64</span> <span class="token keyword">Xor</span> <span class="token number">213</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">61</span> <span class="token keyword">Xor</span> <span class="token number">122</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token keyword">Xor</span> <span class="token number">29</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token operator">+</span><span class="token number">134</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">237</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">End</span> <span class="token keyword">Sub</span>
<span class="token keyword">Public</span> <span class="token keyword">Function</span> KWcnPHwXPA<span class="token punctuation">(</span><span class="token keyword">ByVal</span> WyGwDJjQmpPM <span class="token keyword">As</span> <span class="token keyword">String</span><span class="token punctuation">)</span> <span class="token keyword">As</span> <span class="token keyword">Byte</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">If</span> <span class="token keyword">Not</span> DQdqmDHFAZsXlO <span class="token keyword">Then</span> VjSimTuxaHK
<span class="token keyword">Dim</span> YusDIhkwWF<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">As</span> <span class="token keyword">Byte</span><span class="token punctuation">:</span> YusDIhkwWF <span class="token operator">=</span> jIuArLmtySP<span class="token punctuation">(</span>WyGwDJjQmpPM<span class="token punctuation">)</span>
<span class="token keyword">Dim</span> eqmzXFGApJxQ <span class="token keyword">As</span> <span class="token keyword">Long</span><span class="token punctuation">:</span> eqmzXFGApJxQ <span class="token operator">=</span> UBound<span class="token punctuation">(</span>YusDIhkwWF<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token keyword">Xor</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">If</span> eqmzXFGApJxQ <span class="token keyword">Mod</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token keyword">Xor</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span><span class="token operator">></span> <span class="token number">0</span> <span class="token keyword">Then</span> Err<span class="token punctuation">.</span>Raise vbObjectError<span class="token punctuation">,</span> <span class="token punctuation">,</span> <span class="token string">""</span>
<span class="token keyword">Do</span> <span class="token keyword">While</span> eqmzXFGApJxQ <span class="token operator">></span> <span class="token number">0</span>
<span class="token keyword">If</span> YusDIhkwWF<span class="token punctuation">(</span>eqmzXFGApJxQ <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span><span class="token operator">></span> Asc<span class="token punctuation">(</span><span class="token string">"="</span><span class="token punctuation">)</span> <span class="token keyword">Then</span> <span class="token keyword">Exit</span> <span class="token keyword">Do</span>
eqmzXFGApJxQ <span class="token operator">=</span> eqmzXFGApJxQ <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token keyword">Xor</span> <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token keyword">Loop</span>
<span class="token keyword">Dim</span> OqhxSKRyhLn <span class="token keyword">As</span> <span class="token keyword">Long</span><span class="token punctuation">:</span> OqhxSKRyhLn <span class="token operator">=</span> <span class="token punctuation">(</span>eqmzXFGApJxQ <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token number">3</span> <span class="token keyword">Xor</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">\</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token keyword">Xor</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">Dim</span> MTtJcOcfrKhv<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">As</span> <span class="token keyword">Byte</span>
<span class="token keyword">ReDim</span> MTtJcOcfrKhv<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token keyword">Xor</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">To</span> OqhxSKRyhLn <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">As</span> <span class="token keyword">Byte</span>
<span class="token keyword">Dim</span> EtCjywfjssUWc <span class="token keyword">As</span> <span class="token keyword">Long</span>
<span class="token keyword">Dim</span> XjDMeszHGiIFe <span class="token keyword">As</span> <span class="token keyword">Long</span>
<span class="token keyword">Do</span> <span class="token keyword">While</span> EtCjywfjssUWc <span class="token operator">&lt;</span> eqmzXFGApJxQ
<span class="token keyword">Dim</span> tkPecfFdocqqBt <span class="token keyword">As</span> <span class="token keyword">Byte</span><span class="token punctuation">:</span> tkPecfFdocqqBt <span class="token operator">=</span> YusDIhkwWF<span class="token punctuation">(</span>EtCjywfjssUWc<span class="token punctuation">)</span><span class="token punctuation">:</span> EtCjywfjssUWc <span class="token operator">=</span> EtCjywfjssUWc <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token keyword">Xor</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token keyword">Dim</span> CAWpFwggkrrZh <span class="token keyword">As</span> <span class="token keyword">Byte</span><span class="token punctuation">:</span> CAWpFwggkrrZh <span class="token operator">=</span> YusDIhkwWF<span class="token punctuation">(</span>EtCjywfjssUWc<span class="token punctuation">)</span><span class="token punctuation">:</span> EtCjywfjssUWc <span class="token operator">=</span> EtCjywfjssUWc <span class="token operator">+</span> <span class="token number">1</span>
<span class="token keyword">Dim</span> ujzMwVqMml <span class="token keyword">As</span> <span class="token keyword">Byte</span><span class="token punctuation">:</span> <span class="token keyword">If</span> EtCjywfjssUWc <span class="token operator">&lt;</span> eqmzXFGApJxQ <span class="token keyword">Then</span> ujzMwVqMml <span class="token operator">=</span> YusDIhkwWF<span class="token punctuation">(</span>EtCjywfjssUWc<span class="token punctuation">)</span><span class="token punctuation">:</span> EtCjywfjssUWc <span class="token operator">=</span> EtCjywfjssUWc <span class="token operator">+</span> <span class="token number">1</span> <span class="token keyword">Else</span> ujzMwVqMml <span class="token operator">=</span> Asc<span class="token punctuation">(</span><span class="token string">"A"</span><span class="token punctuation">)</span>
<span class="token keyword">Dim</span> QVokeaazcWcAqh <span class="token keyword">As</span> <span class="token keyword">Byte</span><span class="token punctuation">:</span> <span class="token keyword">If</span> EtCjywfjssUWc <span class="token operator">&lt;</span> eqmzXFGApJxQ <span class="token keyword">Then</span> QVokeaazcWcAqh <span class="token operator">=</span> YusDIhkwWF<span class="token punctuation">(</span>EtCjywfjssUWc<span class="token punctuation">)</span><span class="token punctuation">:</span> EtCjywfjssUWc <span class="token operator">=</span> EtCjywfjssUWc <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token keyword">Xor</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">Else</span> QVokeaazcWcAqh <span class="token operator">=</span> Asc<span class="token punctuation">(</span><span class="token string">"A"</span><span class="token punctuation">)</span>
<span class="token keyword">If</span> tkPecfFdocqqBt <span class="token operator">></span> <span class="token punctuation">(</span><span class="token number">2</span> <span class="token keyword">Xor</span> <span class="token number">125</span><span class="token punctuation">)</span> <span class="token keyword">Or</span> CAWpFwggkrrZh <span class="token operator">></span> <span class="token punctuation">(</span><span class="token number">85</span><span class="token operator">+</span><span class="token number">42</span><span class="token punctuation">)</span> <span class="token keyword">Or</span> ujzMwVqMml <span class="token operator">></span> <span class="token number">127</span> <span class="token keyword">Or</span> QVokeaazcWcAqh <span class="token operator">></span> <span class="token number">127</span> <span class="token keyword">Then</span> <span class="token operator">_</span>
Err<span class="token punctuation">.</span>Raise vbObjectError<span class="token punctuation">,</span> <span class="token punctuation">,</span> <span class="token string">""</span>
<span class="token keyword">Dim</span> mhKBvnFFuztlFT <span class="token keyword">As</span> <span class="token keyword">Byte</span><span class="token punctuation">:</span> mhKBvnFFuztlFT <span class="token operator">=</span> QKJZqUIcJuC<span class="token punctuation">(</span>tkPecfFdocqqBt<span class="token punctuation">)</span>
<span class="token keyword">Dim</span> WAGoWUDaPZsf <span class="token keyword">As</span> <span class="token keyword">Byte</span><span class="token punctuation">:</span> WAGoWUDaPZsf <span class="token operator">=</span> QKJZqUIcJuC<span class="token punctuation">(</span>CAWpFwggkrrZh<span class="token punctuation">)</span>
<span class="token keyword">Dim</span> CdOASRvZYFf <span class="token keyword">As</span> <span class="token keyword">Byte</span><span class="token punctuation">:</span> CdOASRvZYFf <span class="token operator">=</span> QKJZqUIcJuC<span class="token punctuation">(</span>ujzMwVqMml<span class="token punctuation">)</span>
<span class="token keyword">Dim</span> uvMHorqBPp <span class="token keyword">As</span> <span class="token keyword">Byte</span><span class="token punctuation">:</span> uvMHorqBPp <span class="token operator">=</span> QKJZqUIcJuC<span class="token punctuation">(</span>QVokeaazcWcAqh<span class="token punctuation">)</span>
<span class="token keyword">If</span> mhKBvnFFuztlFT <span class="token operator">></span> <span class="token punctuation">(</span><span class="token number">0</span> <span class="token keyword">Xor</span> <span class="token number">63</span><span class="token punctuation">)</span> <span class="token keyword">Or</span> WAGoWUDaPZsf <span class="token operator">></span> <span class="token punctuation">(</span><span class="token number">28</span> <span class="token keyword">Xor</span> <span class="token number">35</span><span class="token punctuation">)</span> <span class="token keyword">Or</span> CdOASRvZYFf <span class="token operator">></span> <span class="token punctuation">(</span><span class="token number">9</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token number">44</span> <span class="token keyword">Xor</span> <span class="token number">26</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">Or</span> uvMHorqBPp <span class="token operator">></span> <span class="token punctuation">(</span><span class="token number">20</span> <span class="token keyword">Xor</span> <span class="token number">43</span><span class="token punctuation">)</span> <span class="token keyword">Then</span> <span class="token operator">_</span>
Err<span class="token punctuation">.</span>Raise vbObjectError<span class="token punctuation">,</span> <span class="token punctuation">,</span> <span class="token string">""</span>
<span class="token keyword">Dim</span> lTiZJdRtkLB <span class="token keyword">As</span> <span class="token keyword">Byte</span><span class="token punctuation">:</span> lTiZJdRtkLB <span class="token operator">=</span> <span class="token punctuation">(</span>mhKBvnFFuztlFT <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token keyword">Xor</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">Or</span> <span class="token punctuation">(</span>WAGoWUDaPZsf <span class="token operator">\</span> <span class="token number">&amp;H10</span><span class="token punctuation">)</span>
<span class="token keyword">Dim</span> ySWAPIOelVOo <span class="token keyword">As</span> <span class="token keyword">Byte</span><span class="token punctuation">:</span> ySWAPIOelVOo <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>WAGoWUDaPZsf <span class="token keyword">And</span> <span class="token number">&amp;HF</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">&amp;H10</span><span class="token punctuation">)</span> <span class="token keyword">Or</span> <span class="token punctuation">(</span>CdOASRvZYFf <span class="token operator">\</span> <span class="token number">4</span><span class="token punctuation">)</span>
<span class="token keyword">Dim</span> DtzSAaMlHrPSN <span class="token keyword">As</span> <span class="token keyword">Byte</span><span class="token punctuation">:</span> DtzSAaMlHrPSN <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>CdOASRvZYFf <span class="token keyword">And</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token operator">+</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">&amp;H40</span><span class="token punctuation">)</span> <span class="token keyword">Or</span> uvMHorqBPp
MTtJcOcfrKhv<span class="token punctuation">(</span>XjDMeszHGiIFe<span class="token punctuation">)</span> <span class="token operator">=</span> lTiZJdRtkLB<span class="token punctuation">:</span> XjDMeszHGiIFe <span class="token operator">=</span> XjDMeszHGiIFe <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">0</span> <span class="token keyword">Xor</span> <span class="token number">1</span><span class="token punctuation">)</span>
<span class="token keyword">If</span> XjDMeszHGiIFe <span class="token operator">&lt;</span> OqhxSKRyhLn <span class="token keyword">Then</span> MTtJcOcfrKhv<span class="token punctuation">(</span>XjDMeszHGiIFe<span class="token punctuation">)</span> <span class="token operator">=</span> ySWAPIOelVOo<span class="token punctuation">:</span> XjDMeszHGiIFe <span class="token operator">=</span> XjDMeszHGiIFe <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">+</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token keyword">If</span> XjDMeszHGiIFe <span class="token operator">&lt;</span> OqhxSKRyhLn <span class="token keyword">Then</span> MTtJcOcfrKhv<span class="token punctuation">(</span>XjDMeszHGiIFe<span class="token punctuation">)</span> <span class="token operator">=</span> DtzSAaMlHrPSN<span class="token punctuation">:</span> XjDMeszHGiIFe <span class="token operator">=</span> XjDMeszHGiIFe <span class="token operator">+</span> <span class="token number">1</span>
<span class="token keyword">Loop</span>
KWcnPHwXPA <span class="token operator">=</span> MTtJcOcfrKhv
<span class="token keyword">End</span> <span class="token keyword">Function</span>
<span class="token keyword">Private</span> <span class="token keyword">Sub</span> VjSimTuxaHK<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">Dim</span> OIMIqegisYd <span class="token keyword">As</span> <span class="token keyword">Integer</span><span class="token punctuation">,</span> HYiTBTPmizHm <span class="token keyword">As</span> <span class="token keyword">Integer</span>
HYiTBTPmizHm <span class="token operator">=</span> <span class="token number">0</span>
<span class="token keyword">For</span> OIMIqegisYd <span class="token operator">=</span> Asc<span class="token punctuation">(</span><span class="token string">"A"</span><span class="token punctuation">)</span> <span class="token keyword">To</span> Asc<span class="token punctuation">(</span><span class="token string">"Z"</span><span class="token punctuation">)</span><span class="token punctuation">:</span> phLmzjBheZF<span class="token punctuation">(</span>HYiTBTPmizHm<span class="token punctuation">)</span> <span class="token operator">=</span> OIMIqegisYd<span class="token punctuation">:</span> HYiTBTPmizHm <span class="token operator">=</span> HYiTBTPmizHm <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">:</span> <span class="token keyword">Next</span>
<span class="token keyword">For</span> OIMIqegisYd <span class="token operator">=</span> Asc<span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">)</span> <span class="token keyword">To</span> Asc<span class="token punctuation">(</span><span class="token string">"z"</span><span class="token punctuation">)</span><span class="token punctuation">:</span> phLmzjBheZF<span class="token punctuation">(</span>HYiTBTPmizHm<span class="token punctuation">)</span> <span class="token operator">=</span> OIMIqegisYd<span class="token punctuation">:</span> HYiTBTPmizHm <span class="token operator">=</span> HYiTBTPmizHm <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">:</span> <span class="token keyword">Next</span>
<span class="token keyword">For</span> OIMIqegisYd <span class="token operator">=</span> Asc<span class="token punctuation">(</span><span class="token string">"0"</span><span class="token punctuation">)</span> <span class="token keyword">To</span> Asc<span class="token punctuation">(</span><span class="token string">"9"</span><span class="token punctuation">)</span><span class="token punctuation">:</span> phLmzjBheZF<span class="token punctuation">(</span>HYiTBTPmizHm<span class="token punctuation">)</span> <span class="token operator">=</span> OIMIqegisYd<span class="token punctuation">:</span> HYiTBTPmizHm <span class="token operator">=</span> HYiTBTPmizHm <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">0</span> <span class="token keyword">Xor</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">Next</span>
phLmzjBheZF<span class="token punctuation">(</span>HYiTBTPmizHm<span class="token punctuation">)</span> <span class="token operator">=</span> Asc<span class="token punctuation">(</span><span class="token string">"+"</span><span class="token punctuation">)</span><span class="token punctuation">:</span> HYiTBTPmizHm <span class="token operator">=</span> HYiTBTPmizHm <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token keyword">Xor</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token keyword">Xor</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
phLmzjBheZF<span class="token punctuation">(</span>HYiTBTPmizHm<span class="token punctuation">)</span> <span class="token operator">=</span> Asc<span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span><span class="token punctuation">:</span> HYiTBTPmizHm <span class="token operator">=</span> HYiTBTPmizHm <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token keyword">Xor</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token keyword">Xor</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">For</span> HYiTBTPmizHm <span class="token operator">=</span> <span class="token number">0</span> <span class="token keyword">To</span> <span class="token number">127</span><span class="token punctuation">:</span> QKJZqUIcJuC<span class="token punctuation">(</span>HYiTBTPmizHm<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">147</span><span class="token operator">+</span><span class="token number">108</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">Next</span>
<span class="token keyword">For</span> HYiTBTPmizHm <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0</span> <span class="token keyword">Xor</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">To</span> <span class="token punctuation">(</span><span class="token number">61</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token keyword">Xor</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span> QKJZqUIcJuC<span class="token punctuation">(</span>phLmzjBheZF<span class="token punctuation">(</span>HYiTBTPmizHm<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">=</span> HYiTBTPmizHm<span class="token punctuation">:</span> <span class="token keyword">Next</span>
DQdqmDHFAZsXlO <span class="token operator">=</span> <span class="token boolean">True</span>
<span class="token keyword">End</span> <span class="token keyword">Sub</span>
<span class="token keyword">Private</span> <span class="token keyword">Function</span> jIuArLmtySP<span class="token punctuation">(</span><span class="token keyword">ByVal</span> WyGwDJjQmpPM <span class="token keyword">As</span> <span class="token keyword">String</span><span class="token punctuation">)</span> <span class="token keyword">As</span> <span class="token keyword">Byte</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">Dim</span> WAGoWUDaPZsf<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">As</span> <span class="token keyword">Byte</span><span class="token punctuation">:</span> WAGoWUDaPZsf <span class="token operator">=</span> WyGwDJjQmpPM
<span class="token keyword">Dim</span> ohnKHLnEngC <span class="token keyword">As</span> <span class="token keyword">Long</span><span class="token punctuation">:</span> ohnKHLnEngC <span class="token operator">=</span> <span class="token punctuation">(</span>UBound<span class="token punctuation">(</span>WAGoWUDaPZsf<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token keyword">Xor</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">\</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token keyword">Xor</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token keyword">If</span> ohnKHLnEngC <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0</span> <span class="token keyword">Xor</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">Then</span> jIuArLmtySP <span class="token operator">=</span> WAGoWUDaPZsf<span class="token punctuation">:</span> <span class="token keyword">Exit</span> <span class="token keyword">Function</span>
<span class="token keyword">Dim</span> CdOASRvZYFf<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">As</span> <span class="token keyword">Byte</span>
<span class="token keyword">ReDim</span> CdOASRvZYFf<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token operator">+</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">To</span> ohnKHLnEngC <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token number">0</span> <span class="token keyword">Xor</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">As</span> <span class="token keyword">Byte</span>
<span class="token keyword">Dim</span> pulOTurWsADzsz <span class="token keyword">As</span> <span class="token keyword">Long</span>
<span class="token keyword">For</span> pulOTurWsADzsz <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token keyword">Xor</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token keyword">Xor</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">To</span> ohnKHLnEngC <span class="token operator">-</span> <span class="token number">1</span>
<span class="token keyword">Dim</span> OIMIqegisYd <span class="token keyword">As</span> <span class="token keyword">Long</span><span class="token punctuation">:</span> OIMIqegisYd <span class="token operator">=</span> WAGoWUDaPZsf<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token keyword">Xor</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token keyword">Xor</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> pulOTurWsADzsz<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">77</span> <span class="token keyword">Xor</span> <span class="token number">333</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token keyword">CLng</span><span class="token punctuation">(</span>WAGoWUDaPZsf<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token keyword">Xor</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">*</span> pulOTurWsADzsz <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">If</span> OIMIqegisYd <span class="token operator">></span><span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">221</span> <span class="token keyword">Xor</span> <span class="token number">45</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token number">3</span> <span class="token keyword">Xor</span> <span class="token number">19</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">Then</span> OIMIqegisYd <span class="token operator">=</span> Asc<span class="token punctuation">(</span><span class="token string">"?"</span><span class="token punctuation">)</span>
CdOASRvZYFf<span class="token punctuation">(</span>pulOTurWsADzsz<span class="token punctuation">)</span> <span class="token operator">=</span> OIMIqegisYd
<span class="token keyword">Next</span>
jIuArLmtySP <span class="token operator">=</span> CdOASRvZYFf
<span class="token keyword">End</span> <span class="token keyword">Function</span>
<span class="token keyword">Private</span> <span class="token keyword">Function</span> hhWpOZVspDmEP<span class="token punctuation">(</span>oTMVKlBiyrDCp <span class="token keyword">As</span> <span class="token keyword">Variant</span><span class="token punctuation">,</span> NcuNirXMUBbUcq <span class="token keyword">As</span> <span class="token keyword">Integer</span><span class="token punctuation">)</span>
<span class="token keyword">Dim</span> nMFesEttTo <span class="token keyword">As</span> <span class="token keyword">String</span>
<span class="token keyword">Dim</span> PwFVZbOlxLL<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">As</span> <span class="token keyword">Byte</span>
PwFVZbOlxLL <span class="token operator">=</span> KWcnPHwXPA<span class="token punctuation">(</span>ActiveDocument<span class="token punctuation">.</span>Variables<span class="token punctuation">(</span><span class="token string">"IbcdbFKknevSZBHt"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
nMFesEttTo <span class="token operator">=</span> <span class="token string">""</span>
<span class="token keyword">For</span> HYiTBTPmizHm <span class="token operator">=</span> LBound<span class="token punctuation">(</span>oTMVKlBiyrDCp<span class="token punctuation">)</span> <span class="token keyword">To</span> UBound<span class="token punctuation">(</span>oTMVKlBiyrDCp<span class="token punctuation">)</span>
nMFesEttTo <span class="token operator">=</span> nMFesEttTo <span class="token operator">&amp;</span> Chr<span class="token punctuation">(</span>PwFVZbOlxLL<span class="token punctuation">(</span>HYiTBTPmizHm<span class="token operator">+</span>NcuNirXMUBbUcq<span class="token punctuation">)</span> <span class="token keyword">Xor</span> oTMVKlBiyrDCp<span class="token punctuation">(</span>HYiTBTPmizHm<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">Next</span>
hhWpOZVspDmEP <span class="token operator">=</span> nMFesEttTo
<span class="token keyword">End</span> <span class="token keyword">Function</span></code></pre></div>
<hr>
<p>The obfuscated code is what you will find inside the Macro Document which I chose to be the sample.</p>
<p>Now running the sample macro document in any.app.run, I saw that the document made no API calls on the internet, so we can conclude that the script’s deobfuscation is self reliant, so all of the deobfuscation code will be present in the tool itself.</p>
<p>I have scoured through the code, and I have compared every obfuscated function and a sub with the non-obfuscated counterpart so it can be extremely clear as to what the script does.</p>
<p><strong>Obfuscated Variables:-</strong></p>
<div class="gatsby-highlight" data-language="vb"><pre class="language-vb"><code class="language-vb"><span class="token keyword">Private</span> DQdqmDHFAZsXlO       <span class="token keyword">As</span> <span class="token keyword">Boolean</span>
<span class="token keyword">Private</span> phLmzjBheZF<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token keyword">Xor</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">To</span> <span class="token punctuation">(</span><span class="token number">5</span> <span class="token keyword">Xor</span> <span class="token number">58</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token keyword">As</span> <span class="token keyword">Byte</span>
<span class="token keyword">Private</span> QKJZqUIcJuC<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token keyword">Xor</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">To</span> <span class="token punctuation">(</span><span class="token number">51</span> <span class="token keyword">Xor</span> <span class="token number">76</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">As</span> <span class="token keyword">Byte</span></code></pre></div>
<p><strong>Deobfuscated Variables:-</strong></p>
<div class="gatsby-highlight" data-language="vb"><pre class="language-vb"><code class="language-vb"><span class="token keyword">Private</span> InitDone       <span class="token keyword">As</span> <span class="token keyword">Boolean</span>
<span class="token keyword">Private</span> Map1<span class="token punctuation">(</span><span class="token number">0</span> <span class="token keyword">To</span> <span class="token number">63</span><span class="token punctuation">)</span>  <span class="token keyword">As</span> <span class="token keyword">Byte</span>
<span class="token keyword">Private</span> Map2<span class="token punctuation">(</span><span class="token number">0</span> <span class="token keyword">To</span> <span class="token number">127</span><span class="token punctuation">)</span> <span class="token keyword">As</span> <span class="token keyword">Byte</span></code></pre></div>
<p>The <code class="language-text">DQdqmDHFAZsXlO/InitDone</code> variable checks if Private Sub <code class="language-text">VjSimTuxaHK/Init</code> has been called or not by the function <code class="language-text">KWcnPHwXPA/Base64Decode</code>.</p>
<p>The <code class="language-text">phLmzjBheZF/Map1</code> variable is needed for the Private Sub <code class="language-text">VjSimTuxaHK/Init</code>.</p>
<p>The <code class="language-text">QKJZqUIcJuC/Map2</code> variable is needed for the <code class="language-text">KWcnPHwXPA/Base64Decode</code> function.</p>
<hr>
<p><strong>Main VBA Sub:- (Calls the Deobfuscation Functions)</strong></p>
<div class="gatsby-highlight" data-language="vb"><pre class="language-vb"><code class="language-vb"><span class="token keyword">Sub</span> nzOxchBVlT<span class="token punctuation">(</span><span class="token punctuation">)</span>
MsgBox hhWpOZVspDmEP<span class="token punctuation">(</span>Array<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token operator">+</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token keyword">Xor</span> <span class="token number">36</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">190</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token number">8</span> <span class="token keyword">Xor</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">41</span> <span class="token keyword">Xor</span> <span class="token number">89</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">131</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token keyword">Xor</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> hhWpOZVspDmEP<span class="token punctuation">(</span>Array<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">134</span><span class="token operator">+</span><span class="token number">57</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">133</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">30</span> <span class="token keyword">Xor</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">162</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token number">64</span> <span class="token keyword">Xor</span> <span class="token number">213</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">61</span> <span class="token keyword">Xor</span> <span class="token number">122</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token keyword">Xor</span> <span class="token number">29</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token operator">+</span><span class="token number">134</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">237</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">End</span> <span class="token keyword">Sub</span></code></pre></div>
<p><strong>Sub calls the function <em><code class="language-text">hhWpOZVspDmEP/unxor</code></em> to deobfuscate:-</strong></p>
<div class="gatsby-highlight" data-language="vb"><pre class="language-vb"><code class="language-vb"><span class="token keyword">Private</span> <span class="token keyword">Function</span> hhWpOZVspDmEP<span class="token punctuation">(</span>oTMVKlBiyrDCp <span class="token keyword">As</span> <span class="token keyword">Variant</span><span class="token punctuation">,</span> NcuNirXMUBbUcq <span class="token keyword">As</span> <span class="token keyword">Integer</span><span class="token punctuation">)</span>
<span class="token keyword">Dim</span> nMFesEttTo <span class="token keyword">As</span> <span class="token keyword">String</span>
<span class="token keyword">Dim</span> PwFVZbOlxLL<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">As</span> <span class="token keyword">Byte</span>
PwFVZbOlxLL <span class="token operator">=</span> KWcnPHwXPA<span class="token punctuation">(</span>ActiveDocument<span class="token punctuation">.</span>Variables<span class="token punctuation">(</span><span class="token string">"IbcdbFKknevSZBHt"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
nMFesEttTo <span class="token operator">=</span> <span class="token string">""</span>
<span class="token keyword">For</span> HYiTBTPmizHm <span class="token operator">=</span> LBound<span class="token punctuation">(</span>oTMVKlBiyrDCp<span class="token punctuation">)</span> <span class="token keyword">To</span> UBound<span class="token punctuation">(</span>oTMVKlBiyrDCp<span class="token punctuation">)</span>
nMFesEttTo <span class="token operator">=</span> nMFesEttTo <span class="token operator">&amp;</span> Chr<span class="token punctuation">(</span>PwFVZbOlxLL<span class="token punctuation">(</span>HYiTBTPmizHm<span class="token operator">+</span>NcuNirXMUBbUcq<span class="token punctuation">)</span> <span class="token keyword">Xor</span> oTMVKlBiyrDCp<span class="token punctuation">(</span>HYiTBTPmizHm<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">Next</span>
hhWpOZVspDmEP <span class="token operator">=</span> nMFesEttTo
<span class="token keyword">End</span> <span class="token keyword">Function</span></code></pre></div>
<p><strong>Deobfuscated Function:- (vba-obfuscator/obfuscator/modifier/strings/crypt.py)</strong></p>
<div class="gatsby-highlight" data-language="vb"><pre class="language-vb"><code class="language-vb"><span class="token keyword">Private</span> <span class="token keyword">Function</span> unxor<span class="token punctuation">(</span>ciphertext <span class="token keyword">As</span> <span class="token keyword">Variant</span><span class="token punctuation">,</span> start <span class="token keyword">As</span> <span class="token keyword">Integer</span><span class="token punctuation">)</span>
    <span class="token keyword">Dim</span> cleartext <span class="token keyword">As</span> <span class="token keyword">String</span>
    <span class="token keyword">Dim</span> key<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">As</span> <span class="token keyword">Byte</span>
    key <span class="token operator">=</span> Base64Decode<span class="token punctuation">(</span>ActiveDocument<span class="token punctuation">.</span>Variables<span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    cleartext <span class="token operator">=</span> <span class="token string">""</span>
    
    <span class="token keyword">For</span> i <span class="token operator">=</span> LBound<span class="token punctuation">(</span>ciphertext<span class="token punctuation">)</span> <span class="token keyword">To</span> UBound<span class="token punctuation">(</span>ciphertext<span class="token punctuation">)</span>
        cleartext <span class="token operator">=</span> cleartext <span class="token operator">&amp;</span> Chr<span class="token punctuation">(</span>key<span class="token punctuation">(</span>i<span class="token operator">+</span>start<span class="token punctuation">)</span> <span class="token keyword">Xor</span> ciphertext<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">Next</span>
    unxor <span class="token operator">=</span> cleartext
<span class="token keyword">End</span> <span class="token keyword">Function</span></code></pre></div>
<p><strong><em><code class="language-text">hhWpOZVspDmEP/unxor</code></em> calls function <em><code class="language-text">KWcnPHwXPA/Base64Decode</code></em>:-</strong></p>
<div class="gatsby-highlight" data-language="vb"><pre class="language-vb"><code class="language-vb"><span class="token keyword">Public</span> <span class="token keyword">Function</span> KWcnPHwXPA<span class="token punctuation">(</span><span class="token keyword">ByVal</span> WyGwDJjQmpPM <span class="token keyword">As</span> <span class="token keyword">String</span><span class="token punctuation">)</span> <span class="token keyword">As</span> <span class="token keyword">Byte</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">If</span> <span class="token keyword">Not</span> DQdqmDHFAZsXlO <span class="token keyword">Then</span> VjSimTuxaHK
<span class="token keyword">Dim</span> YusDIhkwWF<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">As</span> <span class="token keyword">Byte</span><span class="token punctuation">:</span> YusDIhkwWF <span class="token operator">=</span> jIuArLmtySP<span class="token punctuation">(</span>WyGwDJjQmpPM<span class="token punctuation">)</span>
<span class="token keyword">Dim</span> eqmzXFGApJxQ <span class="token keyword">As</span> <span class="token keyword">Long</span><span class="token punctuation">:</span> eqmzXFGApJxQ <span class="token operator">=</span> UBound<span class="token punctuation">(</span>YusDIhkwWF<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token keyword">Xor</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">If</span> eqmzXFGApJxQ <span class="token keyword">Mod</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token keyword">Xor</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span><span class="token operator">></span> <span class="token number">0</span> <span class="token keyword">Then</span> Err<span class="token punctuation">.</span>Raise vbObjectError<span class="token punctuation">,</span> <span class="token punctuation">,</span> <span class="token string">""</span>
<span class="token keyword">Do</span> <span class="token keyword">While</span> eqmzXFGApJxQ <span class="token operator">></span> <span class="token number">0</span>
<span class="token keyword">If</span> YusDIhkwWF<span class="token punctuation">(</span>eqmzXFGApJxQ <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span><span class="token operator">></span> Asc<span class="token punctuation">(</span><span class="token string">"="</span><span class="token punctuation">)</span> <span class="token keyword">Then</span> <span class="token keyword">Exit</span> <span class="token keyword">Do</span>
eqmzXFGApJxQ <span class="token operator">=</span> eqmzXFGApJxQ <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token keyword">Xor</span> <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token keyword">Loop</span>
<span class="token keyword">Dim</span> OqhxSKRyhLn <span class="token keyword">As</span> <span class="token keyword">Long</span><span class="token punctuation">:</span> OqhxSKRyhLn <span class="token operator">=</span> <span class="token punctuation">(</span>eqmzXFGApJxQ <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token number">3</span> <span class="token keyword">Xor</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">\</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token keyword">Xor</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">Dim</span> MTtJcOcfrKhv<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">As</span> <span class="token keyword">Byte</span>
<span class="token keyword">ReDim</span> MTtJcOcfrKhv<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token keyword">Xor</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">To</span> OqhxSKRyhLn <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">As</span> <span class="token keyword">Byte</span>
<span class="token keyword">Dim</span> EtCjywfjssUWc <span class="token keyword">As</span> <span class="token keyword">Long</span>
<span class="token keyword">Dim</span> XjDMeszHGiIFe <span class="token keyword">As</span> <span class="token keyword">Long</span>
<span class="token keyword">Do</span> <span class="token keyword">While</span> EtCjywfjssUWc <span class="token operator">&lt;</span> eqmzXFGApJxQ
<span class="token keyword">Dim</span> tkPecfFdocqqBt <span class="token keyword">As</span> <span class="token keyword">Byte</span><span class="token punctuation">:</span> tkPecfFdocqqBt <span class="token operator">=</span> YusDIhkwWF<span class="token punctuation">(</span>EtCjywfjssUWc<span class="token punctuation">)</span><span class="token punctuation">:</span> EtCjywfjssUWc <span class="token operator">=</span> EtCjywfjssUWc <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token keyword">Xor</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token keyword">Dim</span> CAWpFwggkrrZh <span class="token keyword">As</span> <span class="token keyword">Byte</span><span class="token punctuation">:</span> CAWpFwggkrrZh <span class="token operator">=</span> YusDIhkwWF<span class="token punctuation">(</span>EtCjywfjssUWc<span class="token punctuation">)</span><span class="token punctuation">:</span> EtCjywfjssUWc <span class="token operator">=</span> EtCjywfjssUWc <span class="token operator">+</span> <span class="token number">1</span>
<span class="token keyword">Dim</span> ujzMwVqMml <span class="token keyword">As</span> <span class="token keyword">Byte</span><span class="token punctuation">:</span> <span class="token keyword">If</span> EtCjywfjssUWc <span class="token operator">&lt;</span> eqmzXFGApJxQ <span class="token keyword">Then</span> ujzMwVqMml <span class="token operator">=</span> YusDIhkwWF<span class="token punctuation">(</span>EtCjywfjssUWc<span class="token punctuation">)</span><span class="token punctuation">:</span> EtCjywfjssUWc <span class="token operator">=</span> EtCjywfjssUWc <span class="token operator">+</span> <span class="token number">1</span> <span class="token keyword">Else</span> ujzMwVqMml <span class="token operator">=</span> Asc<span class="token punctuation">(</span><span class="token string">"A"</span><span class="token punctuation">)</span>
<span class="token keyword">Dim</span> QVokeaazcWcAqh <span class="token keyword">As</span> <span class="token keyword">Byte</span><span class="token punctuation">:</span> <span class="token keyword">If</span> EtCjywfjssUWc <span class="token operator">&lt;</span> eqmzXFGApJxQ <span class="token keyword">Then</span> QVokeaazcWcAqh <span class="token operator">=</span> YusDIhkwWF<span class="token punctuation">(</span>EtCjywfjssUWc<span class="token punctuation">)</span><span class="token punctuation">:</span> EtCjywfjssUWc <span class="token operator">=</span> EtCjywfjssUWc <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token keyword">Xor</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">Else</span> QVokeaazcWcAqh <span class="token operator">=</span> Asc<span class="token punctuation">(</span><span class="token string">"A"</span><span class="token punctuation">)</span>
<span class="token keyword">If</span> tkPecfFdocqqBt <span class="token operator">></span> <span class="token punctuation">(</span><span class="token number">2</span> <span class="token keyword">Xor</span> <span class="token number">125</span><span class="token punctuation">)</span> <span class="token keyword">Or</span> CAWpFwggkrrZh <span class="token operator">></span> <span class="token punctuation">(</span><span class="token number">85</span><span class="token operator">+</span><span class="token number">42</span><span class="token punctuation">)</span> <span class="token keyword">Or</span> ujzMwVqMml <span class="token operator">></span> <span class="token number">127</span> <span class="token keyword">Or</span> QVokeaazcWcAqh <span class="token operator">></span> <span class="token number">127</span> <span class="token keyword">Then</span> <span class="token operator">_</span>
Err<span class="token punctuation">.</span>Raise vbObjectError<span class="token punctuation">,</span> <span class="token punctuation">,</span> <span class="token string">""</span>
<span class="token keyword">Dim</span> mhKBvnFFuztlFT <span class="token keyword">As</span> <span class="token keyword">Byte</span><span class="token punctuation">:</span> mhKBvnFFuztlFT <span class="token operator">=</span> QKJZqUIcJuC<span class="token punctuation">(</span>tkPecfFdocqqBt<span class="token punctuation">)</span>
<span class="token keyword">Dim</span> WAGoWUDaPZsf <span class="token keyword">As</span> <span class="token keyword">Byte</span><span class="token punctuation">:</span> WAGoWUDaPZsf <span class="token operator">=</span> QKJZqUIcJuC<span class="token punctuation">(</span>CAWpFwggkrrZh<span class="token punctuation">)</span>
<span class="token keyword">Dim</span> CdOASRvZYFf <span class="token keyword">As</span> <span class="token keyword">Byte</span><span class="token punctuation">:</span> CdOASRvZYFf <span class="token operator">=</span> QKJZqUIcJuC<span class="token punctuation">(</span>ujzMwVqMml<span class="token punctuation">)</span>
<span class="token keyword">Dim</span> uvMHorqBPp <span class="token keyword">As</span> <span class="token keyword">Byte</span><span class="token punctuation">:</span> uvMHorqBPp <span class="token operator">=</span> QKJZqUIcJuC<span class="token punctuation">(</span>QVokeaazcWcAqh<span class="token punctuation">)</span>
<span class="token keyword">If</span> mhKBvnFFuztlFT <span class="token operator">></span> <span class="token punctuation">(</span><span class="token number">0</span> <span class="token keyword">Xor</span> <span class="token number">63</span><span class="token punctuation">)</span> <span class="token keyword">Or</span> WAGoWUDaPZsf <span class="token operator">></span> <span class="token punctuation">(</span><span class="token number">28</span> <span class="token keyword">Xor</span> <span class="token number">35</span><span class="token punctuation">)</span> <span class="token keyword">Or</span> CdOASRvZYFf <span class="token operator">></span> <span class="token punctuation">(</span><span class="token number">9</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token number">44</span> <span class="token keyword">Xor</span> <span class="token number">26</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">Or</span> uvMHorqBPp <span class="token operator">></span> <span class="token punctuation">(</span><span class="token number">20</span> <span class="token keyword">Xor</span> <span class="token number">43</span><span class="token punctuation">)</span> <span class="token keyword">Then</span> <span class="token operator">_</span>
Err<span class="token punctuation">.</span>Raise vbObjectError<span class="token punctuation">,</span> <span class="token punctuation">,</span> <span class="token string">""</span>
<span class="token keyword">Dim</span> lTiZJdRtkLB <span class="token keyword">As</span> <span class="token keyword">Byte</span><span class="token punctuation">:</span> lTiZJdRtkLB <span class="token operator">=</span> <span class="token punctuation">(</span>mhKBvnFFuztlFT <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token keyword">Xor</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">Or</span> <span class="token punctuation">(</span>WAGoWUDaPZsf <span class="token operator">\</span> <span class="token number">&amp;H10</span><span class="token punctuation">)</span>
<span class="token keyword">Dim</span> ySWAPIOelVOo <span class="token keyword">As</span> <span class="token keyword">Byte</span><span class="token punctuation">:</span> ySWAPIOelVOo <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>WAGoWUDaPZsf <span class="token keyword">And</span> <span class="token number">&amp;HF</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">&amp;H10</span><span class="token punctuation">)</span> <span class="token keyword">Or</span> <span class="token punctuation">(</span>CdOASRvZYFf <span class="token operator">\</span> <span class="token number">4</span><span class="token punctuation">)</span>
<span class="token keyword">Dim</span> DtzSAaMlHrPSN <span class="token keyword">As</span> <span class="token keyword">Byte</span><span class="token punctuation">:</span> DtzSAaMlHrPSN <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>CdOASRvZYFf <span class="token keyword">And</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token operator">+</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">&amp;H40</span><span class="token punctuation">)</span> <span class="token keyword">Or</span> uvMHorqBPp
MTtJcOcfrKhv<span class="token punctuation">(</span>XjDMeszHGiIFe<span class="token punctuation">)</span> <span class="token operator">=</span> lTiZJdRtkLB<span class="token punctuation">:</span> XjDMeszHGiIFe <span class="token operator">=</span> XjDMeszHGiIFe <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">0</span> <span class="token keyword">Xor</span> <span class="token number">1</span><span class="token punctuation">)</span>
<span class="token keyword">If</span> XjDMeszHGiIFe <span class="token operator">&lt;</span> OqhxSKRyhLn <span class="token keyword">Then</span> MTtJcOcfrKhv<span class="token punctuation">(</span>XjDMeszHGiIFe<span class="token punctuation">)</span> <span class="token operator">=</span> ySWAPIOelVOo<span class="token punctuation">:</span> XjDMeszHGiIFe <span class="token operator">=</span> XjDMeszHGiIFe <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">+</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token keyword">If</span> XjDMeszHGiIFe <span class="token operator">&lt;</span> OqhxSKRyhLn <span class="token keyword">Then</span> MTtJcOcfrKhv<span class="token punctuation">(</span>XjDMeszHGiIFe<span class="token punctuation">)</span> <span class="token operator">=</span> DtzSAaMlHrPSN<span class="token punctuation">:</span> XjDMeszHGiIFe <span class="token operator">=</span> XjDMeszHGiIFe <span class="token operator">+</span> <span class="token number">1</span>
<span class="token keyword">Loop</span>
KWcnPHwXPA <span class="token operator">=</span> MTtJcOcfrKhv
<span class="token keyword">End</span> <span class="token keyword">Function</span></code></pre></div>
<p><strong>Deobfuscated Function:- (vba-obfuscator/obfuscator/modifier/strings/base64.vbs)</strong></p>
<div class="gatsby-highlight" data-language="vb"><pre class="language-vb"><code class="language-vb"><span class="token keyword">Public</span> <span class="token keyword">Function</span> Base64Decode<span class="token punctuation">(</span><span class="token keyword">ByVal</span> s <span class="token keyword">As</span> <span class="token keyword">String</span><span class="token punctuation">)</span> <span class="token keyword">As</span> <span class="token keyword">Byte</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
   <span class="token keyword">If</span> <span class="token keyword">Not</span> InitDone <span class="token keyword">Then</span> Init
   <span class="token keyword">Dim</span> IBuf<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">As</span> <span class="token keyword">Byte</span><span class="token punctuation">:</span> IBuf <span class="token operator">=</span> ConvertStringToBytes<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
   <span class="token keyword">Dim</span> ILen <span class="token keyword">As</span> <span class="token keyword">Long</span><span class="token punctuation">:</span> ILen <span class="token operator">=</span> UBound<span class="token punctuation">(</span>IBuf<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span>
   <span class="token comment">' If ILen Mod 4 &lt;> 0 Then Err.Raise vbObjectError, , "Length of Base64 encoded input string is not a multiple of 4."</span>
   <span class="token keyword">If</span> ILen <span class="token keyword">Mod</span> <span class="token number">4</span> <span class="token operator">&lt;</span><span class="token operator">></span> <span class="token number">0</span> <span class="token keyword">Then</span> Err<span class="token punctuation">.</span>Raise vbObjectError<span class="token punctuation">,</span> <span class="token punctuation">,</span> <span class="token string">""</span>
   <span class="token keyword">Do</span> <span class="token keyword">While</span> ILen <span class="token operator">></span> <span class="token number">0</span>
      <span class="token keyword">If</span> IBuf<span class="token punctuation">(</span>ILen <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span><span class="token operator">></span> Asc<span class="token punctuation">(</span><span class="token string">"="</span><span class="token punctuation">)</span> <span class="token keyword">Then</span> <span class="token keyword">Exit</span> <span class="token keyword">Do</span>
      ILen <span class="token operator">=</span> ILen <span class="token operator">-</span> <span class="token number">1</span>
      <span class="token keyword">Loop</span>
   <span class="token keyword">Dim</span> OLen <span class="token keyword">As</span> <span class="token keyword">Long</span><span class="token punctuation">:</span> OLen <span class="token operator">=</span> <span class="token punctuation">(</span>ILen <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">\</span> <span class="token number">4</span>
   <span class="token keyword">Dim</span> <span class="token keyword">Out</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">As</span> <span class="token keyword">Byte</span>
   <span class="token keyword">ReDim</span> <span class="token keyword">Out</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token keyword">To</span> OLen <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">As</span> <span class="token keyword">Byte</span>
   <span class="token keyword">Dim</span> ip <span class="token keyword">As</span> <span class="token keyword">Long</span>
   <span class="token keyword">Dim</span> op <span class="token keyword">As</span> <span class="token keyword">Long</span>
   <span class="token keyword">Do</span> <span class="token keyword">While</span> ip <span class="token operator">&lt;</span> ILen
      <span class="token keyword">Dim</span> i0 <span class="token keyword">As</span> <span class="token keyword">Byte</span><span class="token punctuation">:</span> i0 <span class="token operator">=</span> IBuf<span class="token punctuation">(</span>ip<span class="token punctuation">)</span><span class="token punctuation">:</span> ip <span class="token operator">=</span> ip <span class="token operator">+</span> <span class="token number">1</span>
      <span class="token keyword">Dim</span> i1 <span class="token keyword">As</span> <span class="token keyword">Byte</span><span class="token punctuation">:</span> i1 <span class="token operator">=</span> IBuf<span class="token punctuation">(</span>ip<span class="token punctuation">)</span><span class="token punctuation">:</span> ip <span class="token operator">=</span> ip <span class="token operator">+</span> <span class="token number">1</span>
      <span class="token keyword">Dim</span> i2 <span class="token keyword">As</span> <span class="token keyword">Byte</span><span class="token punctuation">:</span> <span class="token keyword">If</span> ip <span class="token operator">&lt;</span> ILen <span class="token keyword">Then</span> i2 <span class="token operator">=</span> IBuf<span class="token punctuation">(</span>ip<span class="token punctuation">)</span><span class="token punctuation">:</span> ip <span class="token operator">=</span> ip <span class="token operator">+</span> <span class="token number">1</span> <span class="token keyword">Else</span> i2 <span class="token operator">=</span> Asc<span class="token punctuation">(</span><span class="token string">"A"</span><span class="token punctuation">)</span>
      <span class="token keyword">Dim</span> i3 <span class="token keyword">As</span> <span class="token keyword">Byte</span><span class="token punctuation">:</span> <span class="token keyword">If</span> ip <span class="token operator">&lt;</span> ILen <span class="token keyword">Then</span> i3 <span class="token operator">=</span> IBuf<span class="token punctuation">(</span>ip<span class="token punctuation">)</span><span class="token punctuation">:</span> ip <span class="token operator">=</span> ip <span class="token operator">+</span> <span class="token number">1</span> <span class="token keyword">Else</span> i3 <span class="token operator">=</span> Asc<span class="token punctuation">(</span><span class="token string">"A"</span><span class="token punctuation">)</span>
      <span class="token keyword">If</span> i0 <span class="token operator">></span> <span class="token number">127</span> <span class="token keyword">Or</span> i1 <span class="token operator">></span> <span class="token number">127</span> <span class="token keyword">Or</span> i2 <span class="token operator">></span> <span class="token number">127</span> <span class="token keyword">Or</span> i3 <span class="token operator">></span> <span class="token number">127</span> <span class="token keyword">Then</span> <span class="token operator">_</span>
         <span class="token comment">' Err.Raise vbObjectError, , "Illegal character in Base64 encoded data."</span>
         Err<span class="token punctuation">.</span>Raise vbObjectError<span class="token punctuation">,</span> <span class="token punctuation">,</span> <span class="token string">""</span>
      <span class="token keyword">Dim</span> b0 <span class="token keyword">As</span> <span class="token keyword">Byte</span><span class="token punctuation">:</span> b0 <span class="token operator">=</span> Map2<span class="token punctuation">(</span>i0<span class="token punctuation">)</span>
      <span class="token keyword">Dim</span> b1 <span class="token keyword">As</span> <span class="token keyword">Byte</span><span class="token punctuation">:</span> b1 <span class="token operator">=</span> Map2<span class="token punctuation">(</span>i1<span class="token punctuation">)</span>
      <span class="token keyword">Dim</span> b2 <span class="token keyword">As</span> <span class="token keyword">Byte</span><span class="token punctuation">:</span> b2 <span class="token operator">=</span> Map2<span class="token punctuation">(</span>i2<span class="token punctuation">)</span>
      <span class="token keyword">Dim</span> b3 <span class="token keyword">As</span> <span class="token keyword">Byte</span><span class="token punctuation">:</span> b3 <span class="token operator">=</span> Map2<span class="token punctuation">(</span>i3<span class="token punctuation">)</span>
      <span class="token keyword">If</span> b0 <span class="token operator">></span> <span class="token number">63</span> <span class="token keyword">Or</span> b1 <span class="token operator">></span> <span class="token number">63</span> <span class="token keyword">Or</span> b2 <span class="token operator">></span> <span class="token number">63</span> <span class="token keyword">Or</span> b3 <span class="token operator">></span> <span class="token number">63</span> <span class="token keyword">Then</span> <span class="token operator">_</span>
         <span class="token comment">' Err.Raise vbObjectError, , "Illegal character in Base64 encoded data."</span>
         Err<span class="token punctuation">.</span>Raise vbObjectError<span class="token punctuation">,</span> <span class="token punctuation">,</span> <span class="token string">""</span>
      <span class="token keyword">Dim</span> o0 <span class="token keyword">As</span> <span class="token keyword">Byte</span><span class="token punctuation">:</span> o0 <span class="token operator">=</span> <span class="token punctuation">(</span>b0 <span class="token operator">*</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token keyword">Or</span> <span class="token punctuation">(</span>b1 <span class="token operator">\</span> <span class="token number">&amp;H10</span><span class="token punctuation">)</span>
      <span class="token keyword">Dim</span> o1 <span class="token keyword">As</span> <span class="token keyword">Byte</span><span class="token punctuation">:</span> o1 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>b1 <span class="token keyword">And</span> <span class="token number">&amp;HF</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">&amp;H10</span><span class="token punctuation">)</span> <span class="token keyword">Or</span> <span class="token punctuation">(</span>b2 <span class="token operator">\</span> <span class="token number">4</span><span class="token punctuation">)</span>
      <span class="token keyword">Dim</span> o2 <span class="token keyword">As</span> <span class="token keyword">Byte</span><span class="token punctuation">:</span> o2 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>b2 <span class="token keyword">And</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">&amp;H40</span><span class="token punctuation">)</span> <span class="token keyword">Or</span> b3
      <span class="token keyword">Out</span><span class="token punctuation">(</span>op<span class="token punctuation">)</span> <span class="token operator">=</span> o0<span class="token punctuation">:</span> op <span class="token operator">=</span> op <span class="token operator">+</span> <span class="token number">1</span>
      <span class="token keyword">If</span> op <span class="token operator">&lt;</span> OLen <span class="token keyword">Then</span> <span class="token keyword">Out</span><span class="token punctuation">(</span>op<span class="token punctuation">)</span> <span class="token operator">=</span> o1<span class="token punctuation">:</span> op <span class="token operator">=</span> op <span class="token operator">+</span> <span class="token number">1</span>
      <span class="token keyword">If</span> op <span class="token operator">&lt;</span> OLen <span class="token keyword">Then</span> <span class="token keyword">Out</span><span class="token punctuation">(</span>op<span class="token punctuation">)</span> <span class="token operator">=</span> o2<span class="token punctuation">:</span> op <span class="token operator">=</span> op <span class="token operator">+</span> <span class="token number">1</span>
      <span class="token keyword">Loop</span>
   Base64Decode <span class="token operator">=</span> <span class="token keyword">Out</span>
   <span class="token keyword">End</span> <span class="token keyword">Function</span></code></pre></div>
<p>The code checks if the Boolean <code class="language-text">DQdqmDHFAZsXlO/InitDone</code> is TRUE. If not TRUE then it calls Private Sub <code class="language-text">VjSimTuxaHK/Init</code>.</p>
<p><strong><em><code class="language-text">KWcnPHwXPA/Base64Decode</code></em> calls private sub <em><code class="language-text">VjSimTuxaHK/Init</code></em>:-</strong></p>
<div class="gatsby-highlight" data-language="vb"><pre class="language-vb"><code class="language-vb"><span class="token keyword">Private</span> <span class="token keyword">Sub</span> VjSimTuxaHK<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">Dim</span> OIMIqegisYd <span class="token keyword">As</span> <span class="token keyword">Integer</span><span class="token punctuation">,</span> HYiTBTPmizHm <span class="token keyword">As</span> <span class="token keyword">Integer</span>
HYiTBTPmizHm <span class="token operator">=</span> <span class="token number">0</span>
<span class="token keyword">For</span> OIMIqegisYd <span class="token operator">=</span> Asc<span class="token punctuation">(</span><span class="token string">"A"</span><span class="token punctuation">)</span> <span class="token keyword">To</span> Asc<span class="token punctuation">(</span><span class="token string">"Z"</span><span class="token punctuation">)</span><span class="token punctuation">:</span> phLmzjBheZF<span class="token punctuation">(</span>HYiTBTPmizHm<span class="token punctuation">)</span> <span class="token operator">=</span> OIMIqegisYd<span class="token punctuation">:</span> HYiTBTPmizHm <span class="token operator">=</span> HYiTBTPmizHm <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">:</span> <span class="token keyword">Next</span>
<span class="token keyword">For</span> OIMIqegisYd <span class="token operator">=</span> Asc<span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">)</span> <span class="token keyword">To</span> Asc<span class="token punctuation">(</span><span class="token string">"z"</span><span class="token punctuation">)</span><span class="token punctuation">:</span> phLmzjBheZF<span class="token punctuation">(</span>HYiTBTPmizHm<span class="token punctuation">)</span> <span class="token operator">=</span> OIMIqegisYd<span class="token punctuation">:</span> HYiTBTPmizHm <span class="token operator">=</span> HYiTBTPmizHm <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">:</span> <span class="token keyword">Next</span>
<span class="token keyword">For</span> OIMIqegisYd <span class="token operator">=</span> Asc<span class="token punctuation">(</span><span class="token string">"0"</span><span class="token punctuation">)</span> <span class="token keyword">To</span> Asc<span class="token punctuation">(</span><span class="token string">"9"</span><span class="token punctuation">)</span><span class="token punctuation">:</span> phLmzjBheZF<span class="token punctuation">(</span>HYiTBTPmizHm<span class="token punctuation">)</span> <span class="token operator">=</span> OIMIqegisYd<span class="token punctuation">:</span> HYiTBTPmizHm <span class="token operator">=</span> HYiTBTPmizHm <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">0</span> <span class="token keyword">Xor</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">Next</span>
phLmzjBheZF<span class="token punctuation">(</span>HYiTBTPmizHm<span class="token punctuation">)</span> <span class="token operator">=</span> Asc<span class="token punctuation">(</span><span class="token string">"+"</span><span class="token punctuation">)</span><span class="token punctuation">:</span> HYiTBTPmizHm <span class="token operator">=</span> HYiTBTPmizHm <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token keyword">Xor</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token keyword">Xor</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
phLmzjBheZF<span class="token punctuation">(</span>HYiTBTPmizHm<span class="token punctuation">)</span> <span class="token operator">=</span> Asc<span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span><span class="token punctuation">:</span> HYiTBTPmizHm <span class="token operator">=</span> HYiTBTPmizHm <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token keyword">Xor</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token keyword">Xor</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">For</span> HYiTBTPmizHm <span class="token operator">=</span> <span class="token number">0</span> <span class="token keyword">To</span> <span class="token number">127</span><span class="token punctuation">:</span> QKJZqUIcJuC<span class="token punctuation">(</span>HYiTBTPmizHm<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">147</span><span class="token operator">+</span><span class="token number">108</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">Next</span>
<span class="token keyword">For</span> HYiTBTPmizHm <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0</span> <span class="token keyword">Xor</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">To</span> <span class="token punctuation">(</span><span class="token number">61</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token keyword">Xor</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span> QKJZqUIcJuC<span class="token punctuation">(</span>phLmzjBheZF<span class="token punctuation">(</span>HYiTBTPmizHm<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">=</span> HYiTBTPmizHm<span class="token punctuation">:</span> <span class="token keyword">Next</span>
DQdqmDHFAZsXlO <span class="token operator">=</span> <span class="token boolean">True</span>
<span class="token keyword">End</span> <span class="token keyword">Sub</span></code></pre></div>
<p><strong>Deobfuscated Private Sub:- (vba-obfuscator/obfuscator/modifier/strings/base64.vbs)</strong></p>
<div class="gatsby-highlight" data-language="vb"><pre class="language-vb"><code class="language-vb"><span class="token keyword">Private</span> <span class="token keyword">Sub</span> Init<span class="token punctuation">(</span><span class="token punctuation">)</span>
   <span class="token keyword">Dim</span> c <span class="token keyword">As</span> <span class="token keyword">Integer</span><span class="token punctuation">,</span> i <span class="token keyword">As</span> <span class="token keyword">Integer</span>
   <span class="token comment">' set Map1</span>
   i <span class="token operator">=</span> <span class="token number">0</span>
   <span class="token keyword">For</span> c <span class="token operator">=</span> Asc<span class="token punctuation">(</span><span class="token string">"A"</span><span class="token punctuation">)</span> <span class="token keyword">To</span> Asc<span class="token punctuation">(</span><span class="token string">"Z"</span><span class="token punctuation">)</span><span class="token punctuation">:</span> Map1<span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">=</span> c<span class="token punctuation">:</span> i <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">:</span> <span class="token keyword">Next</span>
   <span class="token keyword">For</span> c <span class="token operator">=</span> Asc<span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">)</span> <span class="token keyword">To</span> Asc<span class="token punctuation">(</span><span class="token string">"z"</span><span class="token punctuation">)</span><span class="token punctuation">:</span> Map1<span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">=</span> c<span class="token punctuation">:</span> i <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">:</span> <span class="token keyword">Next</span>
   <span class="token keyword">For</span> c <span class="token operator">=</span> Asc<span class="token punctuation">(</span><span class="token string">"0"</span><span class="token punctuation">)</span> <span class="token keyword">To</span> Asc<span class="token punctuation">(</span><span class="token string">"9"</span><span class="token punctuation">)</span><span class="token punctuation">:</span> Map1<span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">=</span> c<span class="token punctuation">:</span> i <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">:</span> <span class="token keyword">Next</span>
   Map1<span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">=</span> Asc<span class="token punctuation">(</span><span class="token string">"+"</span><span class="token punctuation">)</span><span class="token punctuation">:</span> i <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span>
   Map1<span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">=</span> Asc<span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span><span class="token punctuation">:</span> i <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span>
   <span class="token comment">' set Map2</span>
   <span class="token keyword">For</span> i <span class="token operator">=</span> <span class="token number">0</span> <span class="token keyword">To</span> <span class="token number">127</span><span class="token punctuation">:</span> Map2<span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">255</span><span class="token punctuation">:</span> <span class="token keyword">Next</span>
   <span class="token keyword">For</span> i <span class="token operator">=</span> <span class="token number">0</span> <span class="token keyword">To</span> <span class="token number">63</span><span class="token punctuation">:</span> Map2<span class="token punctuation">(</span>Map1<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">=</span> i<span class="token punctuation">:</span> <span class="token keyword">Next</span>
   InitDone <span class="token operator">=</span> <span class="token boolean">True</span>
   <span class="token keyword">End</span> <span class="token keyword">Sub</span></code></pre></div>
<p>After it’s done executing, it proceeds to change the Boolean <code class="language-text">DQdqmDHFAZsXlO/InitDone</code> to TRUE, then <code class="language-text">KWcnPHwXPA/Base64Decode</code> resumes, and then calls function <code class="language-text">jIuArLmtySP/ConvertStringToBytes</code>.</p>
<p><strong><em><code class="language-text">KWcnPHwXPA/Base64Decode</code></em> calls function <em><code class="language-text">jIuArLmtySP/ConvertStringToBytes</code></em>:-</strong></p>
<div class="gatsby-highlight" data-language="vb"><pre class="language-vb"><code class="language-vb"><span class="token keyword">Private</span> <span class="token keyword">Function</span> jIuArLmtySP<span class="token punctuation">(</span><span class="token keyword">ByVal</span> WyGwDJjQmpPM <span class="token keyword">As</span> <span class="token keyword">String</span><span class="token punctuation">)</span> <span class="token keyword">As</span> <span class="token keyword">Byte</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">Dim</span> WAGoWUDaPZsf<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">As</span> <span class="token keyword">Byte</span><span class="token punctuation">:</span> WAGoWUDaPZsf <span class="token operator">=</span> WyGwDJjQmpPM
<span class="token keyword">Dim</span> ohnKHLnEngC <span class="token keyword">As</span> <span class="token keyword">Long</span><span class="token punctuation">:</span> ohnKHLnEngC <span class="token operator">=</span> <span class="token punctuation">(</span>UBound<span class="token punctuation">(</span>WAGoWUDaPZsf<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token keyword">Xor</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">\</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token keyword">Xor</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token keyword">If</span> ohnKHLnEngC <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0</span> <span class="token keyword">Xor</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">Then</span> jIuArLmtySP <span class="token operator">=</span> WAGoWUDaPZsf<span class="token punctuation">:</span> <span class="token keyword">Exit</span> <span class="token keyword">Function</span>
<span class="token keyword">Dim</span> CdOASRvZYFf<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">As</span> <span class="token keyword">Byte</span>
<span class="token keyword">ReDim</span> CdOASRvZYFf<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token operator">+</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">To</span> ohnKHLnEngC <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token number">0</span> <span class="token keyword">Xor</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">As</span> <span class="token keyword">Byte</span>
<span class="token keyword">Dim</span> pulOTurWsADzsz <span class="token keyword">As</span> <span class="token keyword">Long</span>
<span class="token keyword">For</span> pulOTurWsADzsz <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token keyword">Xor</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token keyword">Xor</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">To</span> ohnKHLnEngC <span class="token operator">-</span> <span class="token number">1</span>
<span class="token keyword">Dim</span> OIMIqegisYd <span class="token keyword">As</span> <span class="token keyword">Long</span><span class="token punctuation">:</span> OIMIqegisYd <span class="token operator">=</span> WAGoWUDaPZsf<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token keyword">Xor</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token keyword">Xor</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> pulOTurWsADzsz<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">77</span> <span class="token keyword">Xor</span> <span class="token number">333</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token keyword">CLng</span><span class="token punctuation">(</span>WAGoWUDaPZsf<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token keyword">Xor</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">*</span> pulOTurWsADzsz <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">If</span> OIMIqegisYd <span class="token operator">></span><span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">221</span> <span class="token keyword">Xor</span> <span class="token number">45</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token number">3</span> <span class="token keyword">Xor</span> <span class="token number">19</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">Then</span> OIMIqegisYd <span class="token operator">=</span> Asc<span class="token punctuation">(</span><span class="token string">"?"</span><span class="token punctuation">)</span>
CdOASRvZYFf<span class="token punctuation">(</span>pulOTurWsADzsz<span class="token punctuation">)</span> <span class="token operator">=</span> OIMIqegisYd
<span class="token keyword">Next</span>
jIuArLmtySP <span class="token operator">=</span> CdOASRvZYFf
<span class="token keyword">End</span> <span class="token keyword">Function</span></code></pre></div>
<p><strong>Deobfuscated Function:- (vba-obfuscator/obfuscator/modifier/strings/base64.vbs)</strong></p>
<div class="gatsby-highlight" data-language="vb"><pre class="language-vb"><code class="language-vb"><span class="token keyword">Private</span> <span class="token keyword">Function</span> ConvertStringToBytes<span class="token punctuation">(</span><span class="token keyword">ByVal</span> s <span class="token keyword">As</span> <span class="token keyword">String</span><span class="token punctuation">)</span> <span class="token keyword">As</span> <span class="token keyword">Byte</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
   <span class="token keyword">Dim</span> b1<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">As</span> <span class="token keyword">Byte</span><span class="token punctuation">:</span> b1 <span class="token operator">=</span> s
   <span class="token keyword">Dim</span> l <span class="token keyword">As</span> <span class="token keyword">Long</span><span class="token punctuation">:</span> l <span class="token operator">=</span> <span class="token punctuation">(</span>UBound<span class="token punctuation">(</span>b1<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">\</span> <span class="token number">2</span>
   <span class="token keyword">If</span> l <span class="token operator">=</span> <span class="token number">0</span> <span class="token keyword">Then</span> ConvertStringToBytes <span class="token operator">=</span> b1<span class="token punctuation">:</span> <span class="token keyword">Exit</span> <span class="token keyword">Function</span>
   <span class="token keyword">Dim</span> b2<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">As</span> <span class="token keyword">Byte</span>
   <span class="token keyword">ReDim</span> b2<span class="token punctuation">(</span><span class="token number">0</span> <span class="token keyword">To</span> l <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">As</span> <span class="token keyword">Byte</span>
   <span class="token keyword">Dim</span> p <span class="token keyword">As</span> <span class="token keyword">Long</span>
   <span class="token keyword">For</span> p <span class="token operator">=</span> <span class="token number">0</span> <span class="token keyword">To</span> l <span class="token operator">-</span> <span class="token number">1</span>
      <span class="token keyword">Dim</span> c <span class="token keyword">As</span> <span class="token keyword">Long</span><span class="token punctuation">:</span> c <span class="token operator">=</span> b1<span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> p<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">256</span> <span class="token operator">*</span> <span class="token keyword">CLng</span><span class="token punctuation">(</span>b1<span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> p <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token keyword">If</span> c <span class="token operator">></span><span class="token operator">=</span> <span class="token number">256</span> <span class="token keyword">Then</span> c <span class="token operator">=</span> Asc<span class="token punctuation">(</span><span class="token string">"?"</span><span class="token punctuation">)</span>
      b2<span class="token punctuation">(</span>p<span class="token punctuation">)</span> <span class="token operator">=</span> c
      <span class="token keyword">Next</span>
   ConvertStringToBytes <span class="token operator">=</span> b2
   <span class="token keyword">End</span> <span class="token keyword">Function</span></code></pre></div>
<p>Coming back to <code class="language-text">hhWpOZVspDmEP/unxor</code> function.</p>
<p>It stores all the data into a variable called <code class="language-text">PwFVZbOlxLL/key</code> and then deobfuscates the code into a variable called <code class="language-text">nMFesEttTo/cleartext</code> and then <code class="language-text">hhWpOZVspDmEP/unxor</code> is set equal to <code class="language-text">nMFesEttTo/cleartext</code>.</p>
<p>The unxor function will be called twice because the string gets divided into two parts and the deobfuscation is run twice with the <code class="language-text">PwFVZbOlxLL/key</code>.</p>
<p>After all of this has happened, the MsgBox is ran, and we get <strong><code class="language-text">“Hello World”</code></strong>!</p>
<hr>
<p>In my opinion, this is a very interesting way of obfuscating a macro script. While nbonnet wrote the white paper for this in French, I was still able to figure out a lot of stuff by manual analysis. In the future, I will go into detail what all the functions do!</p>
<p>Tho this fascinating piece of tool has it’s advantages, I still yet have to see it in a Phishing Campaign to say the least. Waiting for Threat Actors to find this xD</p>
<p>Anyways this was SYN, and soon enough there will be a part 2 to this(?).
Goodbye!</p></div></div></div></div><footer><span class="footerCopyrights">© 2020 Built with <a href="https://www.gatsbyjs.org">Gatsby</a></span></footer></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/vba-macro-obfuscator-analysis";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-1653d2c2e6ee77774bf6.js"],"component---src-pages-404-js":["/component---src-pages-404-js-f4df3fb94b5c3d498458.js"],"component---src-templates-index-js":["/component---src-templates-index-js-dceb330fd0607bb47028.js"],"component---src-templates-page-js":["/component---src-templates-page-js-c8a7600fb6a4a5152f04.js"]};/*]]>*/</script><script src="/component---src-templates-page-js-c8a7600fb6a4a5152f04.js" async=""></script><script src="/55027a988c749907c8d0f13018f728b830987428-3bdefe6b5e62d2156c05.js" async=""></script><script src="/commons-1782296e78d0d411ff5d.js" async=""></script><script src="/styles-89fd2ae28bdf06750a71.js" async=""></script><script src="/app-1653d2c2e6ee77774bf6.js" async=""></script><script src="/framework-5fc6169171e885c3b522.js" async=""></script><script src="/webpack-runtime-a18451bbfb423b887dc4.js" async=""></script></body></html>